require 'robot'

class TheLulz
  include Robot

  def initialize
    chromosome = 1763971828862241058817891447677415986882592706587370699037795198699505489274898341015196974585377655376978036254822350837823701054655904861612368188086714184006246170167341753210796291311729893775587387298300947787963586483989655771062625063039956816322341354048838990004217642757302360041129870932701753525273442195343741274943737363792806963515352480685498542038903295544220814604922075517183943093809004943821537828654194748908932051917635122253716573430121782976355946219208567486789450922998301034421702656
    @synapses = (0..27).map{ |gm| ((chromosome >> (64*gm)) & 18446744073709551615) / 115292150460684697600000000.0 }.reverse
  end

  def tick events
    syn = @synapses.clone
    inputs = [ speed, heading, gun_heading, if events['robot_scanned'].pop then 1.0 else -1.0 end ]
    derp = (0..3).map{ |_| inputs.inject(0){ |x, s| s + x * syn.pop } }

    turn_s, gun_s, acc = (0..2).map{ |_| derp.inject(0){ |x, s| s + x * Math::tanh(x) * syn.pop } }

    turn turn_s * 10.0
    turn_gun gun_s * 7.0
    accelerate acc * 8.0

    if time % 17 == 0
      accelerate -8.0 + rand() * 16.0
      turn -10.0 + rand() * 20.0
    end

    fire 0.1
  end

end
